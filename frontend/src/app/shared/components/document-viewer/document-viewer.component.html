<!-- frontend/src/app/shared/components/document-viewer/document-viewer.component.html -->
<!-- Guard with visible && doc as d so inside `d` is non-null for strict templates -->

<div class="overlay" *ngIf="visible && doc as d">
  <div class="modal" role="dialog" aria-modal="true" [attr.aria-label]="d.fileName">
    <div class="modal-header">
      <h3>{{ d.fileName }}</h3>
      <div>
        <button class="chip" (click)="copyKeywordsToClipboard()" [disabled]="!stats?.length">Copy keywords</button>
        <button class="chip" (click)="close()">Close</button>
      </div>
    </div>

    <div class="modal-body">
      <section style="margin-top:16px;">
        <h4>Keyword statistics (computed from file)</h4>

        <div *ngIf="loading">Computing keyword stats…</div>

        <div *ngIf="!loading && stats?.length">
          <div *ngFor="let s of stats" class="keyword-row">
            <div class="kw-left">
              <span class="kw-word">{{ s.word }}</span>
              <span class="kv-muted">({{ s.score }})</span>
            </div>
            <div class="kw-right">
              <div class="kw-bar-bg"><div class="kw-bar" [style.width.%]="s.percent"></div></div>
              <div class="kw-pct">{{ s.percent }}%</div>
            </div>
          </div>
        </div>

        <div *ngIf="!loading && (!stats || stats.length === 0)" class="kv-muted">
          No keyword statistics available (file may contain no textual content).
        </div>
      </section>

      <section style="margin-top:14px;">
        <h4>Original file</h4>
        <div *ngIf="d.fileUrl; else noOriginal">
          •<a [href]="d.fileUrl" target="_blank" rel="noopener">Open original</a> <br>
          •<a [href]="d.fileUrl" target="_blank" rel="noopener" download>Download original</a>
        </div>
        <ng-template #noOriginal>
          <div class="kv-muted">Original file not available.</div>
        </ng-template>
      </section>
    </div>
  </div>
</div>
